/*! infiDate-js v1.0.0 | MIT License | (c) 2025 Ankit Semwal | https://github.com/AnkitSemwal007/infidate-js */
!function(e){"use strict";const t={MONTH_NAMES:["January","February","March","April","May","June","July","August","September","October","November","December"],MONTH_NAMES_SHORT:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DAY_NAMES:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],DAY_NAMES_SHORT:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],iso:function(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},fdate:function(e){return e.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},formatDate:function(e,n){if(!e||!n)return this.fdate(e);const a=e.getFullYear(),i=e.getMonth(),s=e.getDate(),r=e.getDay(),o={YYYY:a,YY:String(a).slice(-2),MMMM:this.MONTH_NAMES[i],MMM:this.MONTH_NAMES_SHORT[i],MM:String(i+1).padStart(2,"0"),M:i+1,DD:String(s).padStart(2,"0"),D:s,dddd:this.DAY_NAMES[r],ddd:this.DAY_NAMES_SHORT[r],dd:this.DAY_NAMES_SHORT[r].slice(0,2)};return n.replace(/YYYY|YY|MMMM|MMM|MM|M|DD|D|dddd|ddd|dd/g,e=>o[e])},parseDate:function(e){if(!e)return null;if(e instanceof Date)return e;if("today"===e)return new Date;if("string"==typeof e){const t=new Date(e);return isNaN(t.getTime())?null:t}return null},isDateDisabled:function(e,t){if(!t||!Array.isArray(t))return!1;for(let n=0;n<t.length;n++){const a=t[n];if("function"==typeof a){if(a(e))return!0}else if("string"==typeof a){if(this.iso(e)===a)return!0}else if(a instanceof Date&&this.iso(e)===this.iso(a))return!0}return!1},addDays:function(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),n},daysDiff:function(e,t){return Math.round((t-e)/864e5)},isSameDay:function(e,t){return!(!e||!t)&&this.iso(e)===this.iso(t)},getFirstDayOfMonth:function(e){return new Date(e.getFullYear(),e.getMonth(),1)},getLastDayOfMonth:function(e){return new Date(e.getFullYear(),e.getMonth()+1,0)},getDaysInMonth:function(e){return this.getLastDayOfMonth(e).getDate()},generateId:function(){return"infidate-"+Math.random().toString(36).substr(2,9)},debounce:function(e,t){let n;return function(...a){const i=()=>{clearTimeout(n),e(...a)};clearTimeout(n),n=setTimeout(i,t)}},throttle:function(e,t){let n;return function(){const a=arguments,i=this;n||(e.apply(i,a),n=!0,setTimeout(()=>n=!1,t))}}};class n{constructor(e={}){this.config={mode:"single",displayMode:"dropdown",attachTo:null,minDate:null,maxDate:null,disable:[],position:"bottom",closeOnSelect:!0,showBackdrop:!0,title:null,subtitle:null,minRangeDays:1,maxRangeDays:365,allowModeSwitch:!0,defaultToToday:!0,maxMonths:12,initialMonths:8,scrollThreshold:150,onChange:null,onOpen:null,onClose:null,...e},this.isOpen=!1,this.selectedDate=null,this.selectedStartDate=null,this.selectedEndDate=null,this.currentMonth=new Date,this.loadedMonths=[],this.container=null,this.calendar=null,this.attachedElement=null,this.eventListeners=[],this.init()}init(){this.config.attachTo&&(this.attachedElement="string"==typeof this.config.attachTo?document.querySelector(this.config.attachTo):this.config.attachTo),this.createContainer(),this.bindEvents(),"inline"===this.config.displayMode&&this.show(),this.config.defaultToToday&&"single"===this.config.mode&&this.selectDate(new Date)}createContainer(){this.container=document.createElement("div"),this.container.className=`infidate-picker infidate-picker--${this.config.displayMode}`,this.container.id=t.generateId(),"inline"===this.config.displayMode&&this.attachedElement?this.attachedElement.appendChild(this.container):document.body.appendChild(this.container),this.createCalendar()}createCalendar(){const e=`\n        <div class="infidate-calendar">\n          ${"modal"===this.config.displayMode?this.createBackdrop():""}\n          <div class="infidate-content">\n            ${this.createHeader()}\n            <div class="infidate-months-container">\n              <div class="infidate-months" id="${this.container.id}-months"></div>\n            </div>\n          </div>\n        </div>\n      `;this.container.innerHTML=e,this.calendar=this.container.querySelector(".infidate-calendar"),this.monthsContainer=this.container.querySelector(".infidate-months"),this.loadInitialMonths(),this.setupInfiniteScroll()}createBackdrop(){return this.config.showBackdrop?'<div class="infidate-backdrop"></div>':""}createHeader(){return"inline"===this.config.displayMode?`\n          <div class="infidate-header">\n            ${this.config.title?`<h3 class="infidate-title">${this.config.title}</h3>`:""}\n            ${this.config.subtitle?`<p class="infidate-subtitle">${this.config.subtitle}</p>`:""}\n            ${this.config.allowModeSwitch?this.createModeSwitch():""}\n          </div>\n        `:""}createModeSwitch(){return`\n        <div class="infidate-mode-switch">\n          <button type="button" class="infidate-mode-btn ${"single"===this.config.mode?"active":""}" data-mode="single">Single</button>\n          <button type="button" class="infidate-mode-btn ${"range"===this.config.mode?"active":""}" data-mode="range">Range</button>\n        </div>\n      `}loadInitialMonths(){const e=new Date(this.currentMonth);e.setDate(1);for(let t=0;t<this.config.initialMonths;t++){const n=new Date(e);n.setMonth(e.getMonth()+t),this.loadMonth(n)}}loadMonth(e){const n=`${e.getFullYear()}-${e.getMonth()}`;if(this.loadedMonths.includes(n))return;this.loadedMonths.push(n);const a=document.createElement("div");a.className="infidate-month",a.dataset.month=n,a.innerHTML=this.createMonthHTML(e),this.monthsContainer.appendChild(a)}createMonthHTML(e){const n=e.getFullYear(),a=e.getMonth(),i=t.MONTH_NAMES[a],s=new Date(n,a,1),r=new Date(n,a+1,0).getDate(),o=s.getDay();let d=`\n        <div class="infidate-month-header">\n          <h4>${i} ${n}</h4>\n        </div>\n        <div class="infidate-days-header">\n          ${t.DAY_NAMES_SHORT.map(e=>`<div class="infidate-day-name">${e}</div>`).join("")}\n        </div>\n        <div class="infidate-days-grid">\n      `;for(let e=0;e<o;e++)d+='<div class="infidate-day infidate-day--empty"></div>';for(let e=1;e<=r;e++){const i=new Date(n,a,e),s=this.isDateDisabled(i),o=this.isDateSelected(i),c=t.isSameDay(i,new Date),l=this.isDateInRange(i),h=["infidate-day",s?"infidate-day--disabled":"",o?"infidate-day--selected":"",c?"infidate-day--today":"",l?"infidate-day--in-range":""].filter(Boolean).join(" ");d+=`<div class="${h}" data-date="${t.iso(i)}">${e}</div>`}return d+="</div>",d}isDateDisabled(e){if(this.config.minDate){const n=t.parseDate(this.config.minDate);if(n&&e<n)return!0}if(this.config.maxDate){const n=t.parseDate(this.config.maxDate);if(n&&e>n)return!0}return t.isDateDisabled(e,this.config.disable)}isDateSelected(e){return"single"===this.config.mode?this.selectedDate&&t.isSameDay(e,this.selectedDate):this.selectedStartDate&&t.isSameDay(e,this.selectedStartDate)||this.selectedEndDate&&t.isSameDay(e,this.selectedEndDate)}isDateInRange(e){return"range"===this.config.mode&&this.selectedStartDate&&this.selectedEndDate&&e>this.selectedStartDate&&e<this.selectedEndDate}setupInfiniteScroll(){const e=t.throttle(()=>{const e=this.monthsContainer,t=e.scrollTop,n=e.scrollHeight,a=e.clientHeight;n-t-a<this.config.scrollThreshold&&this.loadMoreMonths()},100);this.monthsContainer.addEventListener("scroll",e),this.eventListeners.push({element:this.monthsContainer,event:"scroll",handler:e})}loadMoreMonths(){if(this.loadedMonths.length>=this.config.maxMonths)return;const e=this.loadedMonths[this.loadedMonths.length-1],[t,n]=e.split("-").map(Number),a=new Date(t,n+1,1);this.loadMonth(a)}bindEvents(){const e=e=>{const t=e.target.closest(".infidate-day");if(!t||t.classList.contains("infidate-day--disabled")||t.classList.contains("infidate-day--empty"))return;const n=t.dataset.date;if(n){const e=new Date(n);this.selectDate(e)}};if(this.container.addEventListener("click",e),this.eventListeners.push({element:this.container,event:"click",handler:e}),this.config.allowModeSwitch){const e=e=>{const t=e.target.closest(".infidate-mode-btn");if(t){const e=t.dataset.mode;this.switchMode(e)}};this.container.addEventListener("click",e),this.eventListeners.push({element:this.container,event:"click",handler:e})}"inline"!==this.config.displayMode&&this.bindDropdownModalEvents(),this.bindKeyboardEvents()}bindDropdownModalEvents(){if(this.attachedElement){const e=()=>this.show();this.attachedElement.addEventListener("click",e),this.eventListeners.push({element:this.attachedElement,event:"click",handler:e})}const e=e=>{this.isOpen&&!this.container.contains(e.target)&&(!this.attachedElement||!this.attachedElement.contains(e.target))&&this.hide()};if(document.addEventListener("click",e),this.eventListeners.push({element:document,event:"click",handler:e}),"modal"===this.config.displayMode){const e=e=>{e.target.classList.contains("infidate-backdrop")&&this.hide()};this.container.addEventListener("click",e),this.eventListeners.push({element:this.container,event:"click",handler:e})}if("dropdown"===this.config.displayMode){const e=t.throttle(()=>{this.isOpen&&this.positionDropdown()},16);window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),this.eventListeners.push({element:window,event:"scroll",handler:e,options:!0},{element:window,event:"resize",handler:e})}}bindKeyboardEvents(){const e=e=>{if(!this.isOpen)return;switch(e.key){case"Escape":e.preventDefault(),this.hide();break;case"Enter":case" ":e.preventDefault();const t=this.container.querySelector(".infidate-day:focus");if(t&&!t.classList.contains("infidate-day--disabled")){const e=t.dataset.date;e&&this.selectDate(new Date(e))}}};document.addEventListener("keydown",e),this.eventListeners.push({element:document,event:"keydown",handler:e})}selectDate(e){this.isDateDisabled(e)||("single"===this.config.mode?(this.selectedDate=e,this.updateDisplay(),this.triggerChange(),this.config.closeOnSelect&&"inline"!==this.config.displayMode&&this.hide()):this.handleRangeSelection(e))}handleRangeSelection(e){if(!this.selectedStartDate||this.selectedStartDate&&this.selectedEndDate)this.selectedStartDate=e,this.selectedEndDate=null;else if(e<this.selectedStartDate)this.selectedStartDate=e,this.selectedEndDate=null;else{this.selectedEndDate=e;const n=t.daysDiff(this.selectedStartDate,this.selectedEndDate);if(n<this.config.minRangeDays-1)return this.selectedStartDate=e,void(this.selectedEndDate=null);if(n>this.config.maxRangeDays-1)return this.selectedStartDate=e,void(this.selectedEndDate=null);this.triggerChange(),this.config.closeOnSelect&&"inline"!==this.config.displayMode&&this.hide()}this.updateDisplay()}updateDisplay(){const e=this.container.querySelectorAll(".infidate-day[data-date]");e.forEach(e=>{const n=e.dataset.date,a=new Date(n);e.className="infidate-day",this.isDateDisabled(a)&&e.classList.add("infidate-day--disabled"),this.isDateSelected(a)&&e.classList.add("infidate-day--selected"),t.isSameDay(a,new Date)&&e.classList.add("infidate-day--today"),this.isDateInRange(a)&&e.classList.add("infidate-day--in-range")}),this.attachedElement&&"INPUT"===this.attachedElement.tagName&&(this.attachedElement.value=this.getFormattedValue())}getFormattedValue(){if("single"===this.config.mode)return this.selectedDate?t.formatDate(this.selectedDate,"MMM D, YYYY"):"";if(this.selectedStartDate&&this.selectedEndDate){const e=t.formatDate(this.selectedStartDate,"MMM D, YYYY"),n=t.formatDate(this.selectedEndDate,"MMM D, YYYY");return`${e} to ${n}`}return this.selectedStartDate?t.formatDate(this.selectedStartDate,"MMM D, YYYY"):""}triggerChange(){if(this.config.onChange){const e=this.getChangeData();this.config.onChange(e)}}getChangeData(){if("single"===this.config.mode)return{date:this.selectedDate,formatted:this.selectedDate?t.formatDate(this.selectedDate,"MMM D, YYYY"):null,iso:this.selectedDate?t.iso(this.selectedDate):null};const e={start:this.selectedStartDate,end:this.selectedEndDate,formatted:this.getFormattedValue()};return this.selectedStartDate&&this.selectedEndDate&&(e.nights=t.daysDiff(this.selectedStartDate,this.selectedEndDate),e.days=e.nights+1),e}switchMode(e){e!==this.config.mode&&(this.config.mode=e,this.selectedDate=null,this.selectedStartDate=null,this.selectedEndDate=null,this.container.querySelectorAll(".infidate-mode-btn").forEach(t=>{t.classList.toggle("active",t.dataset.mode===e)}),this.updateDisplay())}show(){this.isOpen||(this.isOpen=!0,this.container.classList.add("infidate-picker--open"),"dropdown"===this.config.displayMode&&this.positionDropdown(),"modal"===this.config.displayMode&&(document.body.style.overflow="hidden"),this.config.onOpen&&this.config.onOpen())}hide(){this.isOpen&&(this.isOpen=!1,this.container.classList.remove("infidate-picker--open"),"modal"===this.config.displayMode&&(document.body.style.overflow=""),this.config.onClose&&this.config.onClose())}positionDropdown(){if(!this.attachedElement||"dropdown"!==this.config.displayMode)return;const e=this.attachedElement.getBoundingClientRect(),t=this.calendar.getBoundingClientRect(),n=window.innerHeight;let a,i;i=e.left;const s=n-e.bottom,r=e.top;a="top"===this.config.position||"auto"===this.config.position&&s<t.height&&r>s?e.top-t.height-2:e.bottom+2,this.calendar.style.position="fixed",this.calendar.style.top=`${a}px`,this.calendar.style.left=`${i}px`,this.calendar.style.zIndex="9999"}destroy(){this.eventListeners.forEach(({element:e,event:t,handler:n,options:a})=>{e.removeEventListener(t,n,a)}),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),"modal"===this.config.displayMode&&this.isOpen&&(document.body.style.overflow=""),this.container=null,this.calendar=null,this.attachedElement=null,this.eventListeners=[]}}const a={version:"1.0.0",defaults:{mode:"single",displayMode:"dropdown",minDate:null,maxDate:null,disable:[],position:"bottom",closeOnSelect:!0,showBackdrop:!0,title:null,subtitle:null,minRangeDays:1,maxRangeDays:365,allowModeSwitch:!0,defaultToToday:!1,maxMonths:12,initialMonths:8,scrollThreshold:150},create:function(e,t={}){const a={...this.defaults,...t};return e&&(a.attachTo=e),new n(a)},singleModal:function(e,t){return this.create(e,{mode:"single",displayMode:"modal",onChange:t})},singleDropdown:function(e,t){return this.create(e,{mode:"single",displayMode:"dropdown",onChange:t})},rangeModal:function(e,t){return this.create(e,{mode:"range",displayMode:"modal",onChange:t})},rangeDropdown:function(e,t){return this.create(e,{mode:"range",displayMode:"dropdown",onChange:t})},openSingleDateModal:function(e,t={}){return this.create(e,{mode:"single",displayMode:"modal",...t})},openSingleDateDropdown:function(e,t={}){return this.create(e,{mode:"single",displayMode:"dropdown",...t})},openRangeDateModal:function(e,t={}){return this.create(e,{mode:"range",displayMode:"modal",...t})},openRangeDateDropdown:function(e,t={}){return this.create(e,{mode:"range",displayMode:"dropdown",...t})},parseDate:t.parseDate,formatDate:t.formatDate,isDateDisabled:t.isDateDisabled,addDays:t.addDays,daysDiff:t.daysDiff,isSameDay:t.isSameDay};"undefined"!=typeof e&&(e.InfiDate=a,e.InfiDatePicker=n,e.InfiDateUtils=t),"undefined"!=typeof module&&module.exports&&(module.exports={InfiDate:a,InfiDatePicker:n,InfiDateUtils:t}),"function"==typeof define&&define.amd&&define(function(){return{InfiDate:a,InfiDatePicker:n,InfiDateUtils:t}})}("undefined"!=typeof window?window:this);
